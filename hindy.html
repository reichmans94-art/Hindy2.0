<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hindy â€” The Frum Smart Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #c9a84c;
    --deep-gold: #8b6914;
    --cream: #fdf6e3;
    --parchment: #f0e6c8;
    --brown: #3d2b1f;
    --dark-brown: #1a0f0a;
    --burgundy: #6b1a2a;
    --green: #1a5c2a;
    --shadow: rgba(61,43,31,0.18);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background: var(--dark-brown);
    min-height: 100vh;
    font-family: 'Lora', Georgia, serif;
    color: var(--brown);
    overflow-x: hidden;
  }
  body::before {
    content:''; position:fixed; inset:0;
    background:
      repeating-linear-gradient(45deg,transparent,transparent 40px,rgba(201,168,76,0.025) 40px,rgba(201,168,76,0.025) 41px),
      repeating-linear-gradient(-45deg,transparent,transparent 40px,rgba(201,168,76,0.025) 40px,rgba(201,168,76,0.025) 41px),
      radial-gradient(ellipse at 20% 50%,rgba(107,26,42,0.12) 0%,transparent 60%),
      radial-gradient(ellipse at 80% 50%,rgba(26,92,92,0.12) 0%,transparent 60%),
      #1a0f0a;
    z-index:0;
  }
  .container {
    position:relative; z-index:1;
    max-width:720px; margin:0 auto;
    padding:20px; min-height:100vh;
    display:flex; flex-direction:column; align-items:center;
  }

/* â”€â”€ Header â”€â”€ */
.header { text-align:center; margin-bottom:16px; padding-top:20px; }
.logo-text {
  font-family:'Playfair Display',serif;
  font-size:clamp(2.8rem,10vw,5rem);
  font-weight:700; color:var(--gold);
  text-shadow:0 0 40px rgba(201,168,76,0.4),2px 2px 0 var(--deep-gold);
  letter-spacing:4px; line-height:1;
  animation:shimmer 3s ease-in-out infinite;
}
@keyframes shimmer {
  0%,100%{text-shadow:0 0 40px rgba(201,168,76,0.4),2px 2px 0 var(--deep-gold)}
  50%{text-shadow:0 0 70px rgba(201,168,76,0.8),2px 2px 0 var(--deep-gold)}
}
.tagline { color:var(--parchment); font-style:italic; font-size:0.85rem; margin-top:5px; opacity:0.7; letter-spacing:1px; }
.decorative-line { width:200px; height:2px; background:linear-gradient(90deg,transparent,var(--gold),transparent); margin:8px auto; }

/* â”€â”€ Language selector â”€â”€ */
.lang-bar {
  display:flex; gap:6px; margin-bottom:12px; flex-wrap:wrap; justify-content:center;
}
.lang-btn {
  background:rgba(240,230,200,0.07); border:1px solid rgba(201,168,76,0.25);
  border-radius:20px; color:var(--parchment); font-family:'Lora',serif;
  font-size:0.75rem; padding:5px 14px; cursor:pointer; transition:all 0.18s;
  letter-spacing:0.5px;
}
.lang-btn:hover, .lang-btn.active {
  background:rgba(201,168,76,0.2); border-color:var(--gold); color:var(--gold);
}

/* â”€â”€ Device â”€â”€ */
.device-wrap { position:relative; margin:4px 0; }
.device {
  width:148px; height:244px;
  background:linear-gradient(160deg,#2a1a10,#1a0d07);
  border-radius:24px; border:2px solid var(--gold);
  box-shadow:0 0 40px rgba(201,168,76,0.2),inset 0 1px 0 rgba(255,255,255,0.06);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:8px; position:relative; overflow:hidden; cursor:pointer; transition:transform 0.2s;
}
.device:hover { transform:scale(1.02); }
.device::before {
  content:''; position:absolute; inset:0;
  background:repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(201,168,76,0.012) 3px,rgba(201,168,76,0.012) 4px);
  pointer-events:none;
}
.device-face {
  width:66px; height:66px; border-radius:50%;
  border:2px solid var(--gold);
  background:radial-gradient(circle at 40% 35%,#c4956a,#7a4a2a);
  display:flex; align-items:center; justify-content:center;
  font-size:32px; box-shadow:0 0 20px rgba(201,168,76,0.25);
  position:relative; overflow:hidden;
}
.wig {
  position:absolute; top:-8px; left:-8px; right:-8px; height:55%;
  background:linear-gradient(160deg,#2a1a0a,#4a2e10,#3a2010);
  border-radius:50% 50% 30% 30%; z-index:2;
}
.face-emoji { position:relative; z-index:3; margin-top:12px; font-size:25px; }
.device-name { font-family:'Playfair Display',serif; color:var(--gold); font-size:0.95rem; letter-spacing:3px; }
.orb {
  width:40px; height:40px; border-radius:50%;
  background:radial-gradient(circle at 35% 35%,rgba(201,168,76,0.9),rgba(139,105,20,0.6));
  border:1px solid var(--gold); cursor:pointer;
  box-shadow:0 0 14px rgba(201,168,76,0.3);
  display:flex; align-items:center; justify-content:center;
  font-size:16px; transition:all 0.2s; user-select:none;
}
.orb.listening { animation:pulseA 1s ease-in-out infinite; box-shadow:0 0 30px rgba(201,168,76,0.85); }
.orb.speaking  { animation:speakA 0.4s ease-in-out infinite; background:radial-gradient(circle at 35% 35%,rgba(107,26,42,0.9),rgba(70,15,25,0.8)); border-color:var(--burgundy); box-shadow:0 0 28px rgba(107,26,42,0.6); }
@keyframes pulseA { 0%,100%{transform:scale(1)} 50%{transform:scale(1.2)} }
@keyframes speakA { 0%,100%{transform:scale(1)} 50%{transform:scale(1.09)} }
.waveform { display:flex; gap:3px; align-items:center; height:20px; opacity:0; transition:opacity 0.3s; }
.waveform.active { opacity:1; }
.wave-bar { width:3px; background:var(--gold); border-radius:2px; animation:waveA 0.8s ease-in-out infinite; }
.wave-bar:nth-child(1){animation-delay:0s;height:8px}.wave-bar:nth-child(2){animation-delay:.1s;height:14px}
.wave-bar:nth-child(3){animation-delay:.2s;height:10px}.wave-bar:nth-child(4){animation-delay:.3s;height:18px}
.wave-bar:nth-child(5){animation-delay:.2s;height:10px}.wave-bar:nth-child(6){animation-delay:.1s;height:14px}
.wave-bar:nth-child(7){animation-delay:0s;height:8px}
@keyframes waveA { 0%,100%{height:4px} 50%{height:18px} }

/* â”€â”€ Location bar â”€â”€ */
.location-bar {
  display:flex; align-items:center; gap:8px;
  background:rgba(201,168,76,0.07); border:1px solid rgba(201,168,76,0.2);
  border-radius:20px; padding:6px 14px; margin-bottom:10px;
  color:rgba(240,230,200,0.6); font-size:0.75rem; letter-spacing:0.5px;
  cursor:pointer; transition:all 0.2s; width:100%;
}
.location-bar:hover { background:rgba(201,168,76,0.12); border-color:var(--gold); color:var(--parchment); }
.location-dot { width:8px; height:8px; border-radius:50%; background:rgba(201,168,76,0.4); flex-shrink:0; }
.location-dot.found { background:#5dbb63; }

/* â”€â”€ Status â”€â”€ */
.status-bar {
  display:flex; align-items:center; gap:8px;
  color:rgba(240,230,200,0.45); font-size:0.73rem;
  margin-bottom:8px; letter-spacing:1px; min-height:18px;
}
.status-dot { width:7px; height:7px; border-radius:50%; background:rgba(201,168,76,0.3); flex-shrink:0; }
.status-dot.listening { background:#5dbb63; animation:pulseA 1s infinite; }
.status-dot.speaking  { background:var(--burgundy); animation:pulseA 0.6s infinite; }
.status-dot.thinking  { background:var(--gold); animation:pulseA 0.8s infinite; }

/* â”€â”€ Response panel â”€â”€ */
.response-panel {
  width:100%; background:var(--cream); border-radius:20px;
  border:2px solid var(--gold); padding:20px 22px; position:relative;
  box-shadow:0 8px 40px var(--shadow),inset 0 1px 0 rgba(255,255,255,0.5);
  min-height:100px;
}
.response-panel::before {
  content:''; position:absolute; top:-12px; left:50%; transform:translateX(-50%);
  width:20px; height:12px; background:var(--cream); clip-path:polygon(50% 0%,0% 100%,100% 100%);
}
.response-panel::after {
  content:''; position:absolute; top:-14px; left:50%; transform:translateX(-50%);
  width:22px; height:14px; background:var(--gold); clip-path:polygon(50% 0%,0% 100%,100% 100%); z-index:-1;
}
.response-label { font-size:0.66rem; letter-spacing:3px; text-transform:uppercase; color:var(--deep-gold); margin-bottom:8px; font-family:'Playfair Display',serif; }
.response-text { font-style:italic; color:var(--brown); line-height:1.75; font-size:0.96rem; min-height:48px; white-space:pre-wrap; }
.response-text.typing::after { content:'â–‹'; animation:blink 0.7s infinite; color:var(--gold); font-style:normal; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
.blessing { margin-top:10px; font-family:'Playfair Display',serif; color:var(--deep-gold); font-size:0.86rem; font-weight:700; text-align:right; opacity:0; transition:opacity 0.6s; }
.blessing.visible { opacity:1; }

/* â”€â”€ Input row â”€â”€ */
.input-row { width:100%; display:flex; gap:8px; align-items:center; margin:12px 0; }
.mic-btn {
  width:54px; height:54px; flex-shrink:0; border-radius:50%;
  background:linear-gradient(135deg,var(--gold),var(--deep-gold));
  border:none; cursor:pointer; font-size:20px;
  box-shadow:0 4px 18px rgba(201,168,76,0.35); transition:all 0.2s;
  display:flex; align-items:center; justify-content:center;
}
.mic-btn:hover:not(.disabled) { transform:scale(1.08); box-shadow:0 6px 28px rgba(201,168,76,0.55); }
.mic-btn.listening { background:linear-gradient(135deg,#a02030,#6b1a2a); box-shadow:0 4px 28px rgba(107,26,42,0.65); animation:pulseA 1s ease-in-out infinite; }
.mic-btn.disabled { opacity:0.35; cursor:not-allowed; background:#2a1a10; box-shadow:none; }
.text-input-wrap { flex:1; position:relative; }
.text-input {
  width:100%; background:rgba(240,230,200,0.08); border:1px solid rgba(201,168,76,0.3);
  border-radius:28px; color:var(--parchment); font-family:'Lora',serif; font-size:0.88rem;
  padding:12px 46px 12px 16px; outline:none; transition:all 0.2s;
}
.text-input::placeholder { color:rgba(240,230,200,0.3); }
.text-input:focus { border-color:var(--gold); background:rgba(240,230,200,0.12); }
.send-btn {
  position:absolute; right:5px; top:50%; transform:translateY(-50%);
  width:32px; height:32px; border-radius:50%;
  background:var(--gold); border:none; cursor:pointer;
  font-size:13px; display:flex; align-items:center; justify-content:center;
  transition:transform 0.15s;
}
.send-btn:hover { transform:translateY(-50%) scale(1.12); }
.mic-hint { width:100%; text-align:center; color:rgba(240,230,200,0.35); font-size:0.7rem; letter-spacing:1.5px; text-transform:uppercase; margin-top:-4px; margin-bottom:4px; min-height:14px; }

/* â”€â”€ Topic tabs â”€â”€ */
.topic-tabs { display:flex; gap:5px; flex-wrap:wrap; justify-content:center; margin:10px 0; width:100%; }
.topic-tab {
  background:rgba(240,230,200,0.06); border:1px solid rgba(201,168,76,0.2);
  border-radius:20px; color:rgba(240,230,200,0.6); font-family:'Lora',serif;
  font-size:0.72rem; padding:5px 12px; cursor:pointer; transition:all 0.18s;
}
.topic-tab:hover, .topic-tab.active {
  background:rgba(201,168,76,0.18); border-color:var(--gold); color:var(--gold);
}

/* â”€â”€ Quick questions â”€â”€ */
.section-title { font-family:'Playfair Display',serif; color:var(--gold); font-size:1rem; text-align:center; margin:12px 0 10px; letter-spacing:2px; }
.questions-grid { width:100%; display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-bottom:20px; }
.q-category {
  grid-column:1/-1; font-family:'Playfair Display',serif; color:var(--parchment);
  font-size:0.7rem; letter-spacing:3px; text-transform:uppercase;
  margin-top:8px; margin-bottom:2px; opacity:0.55;
  border-bottom:1px solid rgba(201,168,76,0.15); padding-bottom:3px;
  display:none;
}
.q-category.visible { display:block; }
.q-btn {
  background:rgba(240,230,200,0.05); border:1px solid rgba(201,168,76,0.18);
  border-radius:10px; color:var(--parchment); font-family:'Lora',serif;
  font-size:0.75rem; padding:8px 10px; cursor:pointer; text-align:left;
  transition:all 0.18s; line-height:1.4; display:none;
}
.q-btn.visible { display:block; }
.q-btn:hover { background:rgba(201,168,76,0.12); border-color:var(--gold); color:var(--gold); transform:translateY(-1px); }
.q-btn.active { background:rgba(201,168,76,0.2); border-color:var(--gold); color:var(--gold); }

/* â”€â”€ API key input â”€â”€ */
.api-section {
  width:100%; background:rgba(201,168,76,0.06); border:1px solid rgba(201,168,76,0.25);
  border-radius:14px; padding:16px 18px; margin-bottom:12px;
}
.api-section p { color:var(--parchment); font-size:0.8rem; line-height:1.6; margin-bottom:10px; }
.api-section p a { color:var(--gold); }
.api-input-row { display:flex; gap:8px; }
.api-input {
  flex:1; background:rgba(0,0,0,0.3); border:1px solid rgba(201,168,76,0.3);
  border-radius:8px; color:var(--parchment); font-family:monospace; font-size:0.8rem;
  padding:8px 12px; outline:none;
}
.api-input:focus { border-color:var(--gold); }
.api-save-btn {
  background:var(--gold); border:none; border-radius:8px;
  color:var(--dark-brown); font-family:'Playfair Display',serif;
  font-weight:700; font-size:0.8rem; padding:8px 16px; cursor:pointer;
}
.api-status { font-size:0.72rem; margin-top:6px; min-height:14px; }
.api-status.ok  { color:#5dbb63; }
.api-status.err { color:#e05555; }

/* â”€â”€ Shabbat / Yom Tov Blocker Overlay â”€â”€ */
#shabbatOverlay {
  display:none; position:fixed; inset:0; z-index:99999;
  background:rgba(10,5,2,0.96);
  align-items:center; justify-content:center;
  animation:overlayIn 0.4s ease;
}
#shabbatOverlay.active { display:flex; }
@keyframes overlayIn { from{opacity:0} to{opacity:1} }

.shabbat-box {
  max-width:480px; width:90%; text-align:center;
  padding:40px 32px;
  background:linear-gradient(160deg,#1a0d07,#0d0704);
  border:2px solid var(--gold);
  border-radius:24px;
  box-shadow:0 0 80px rgba(201,168,76,0.25), 0 0 160px rgba(201,168,76,0.08);
  animation:boxIn 0.5s cubic-bezier(0.34,1.56,0.64,1);
  position:relative; overflow:hidden;
}
@keyframes boxIn { from{transform:scale(0.7) translateY(40px);opacity:0} to{transform:scale(1) translateY(0);opacity:1} }

.shabbat-candles {
  font-size:2.8rem; margin-bottom:8px; letter-spacing:8px;
  animation:candleFlicker 2s ease-in-out infinite alternate;
}
@keyframes candleFlicker {
  0%  { text-shadow:0 0 10px #ffcc44, 0 0 30px #ff9900; opacity:1; }
  50% { text-shadow:0 0 20px #ffdd66, 0 0 50px #ffaa00; opacity:0.9; }
  100%{ text-shadow:0 0 8px  #ffbb22, 0 0 20px #ff8800; opacity:1; }
}

.shabbat-title {
  font-family:'Playfair Display',serif;
  font-size:2rem; color:var(--gold); font-weight:700;
  letter-spacing:3px; margin-bottom:6px;
  text-shadow:0 0 30px rgba(201,168,76,0.5);
}
.shabbat-hebrew {
  font-size:1.4rem; color:var(--parchment); margin-bottom:16px;
  opacity:0.8; letter-spacing:2px;
}
.shabbat-message {
  font-family:'Lora',Georgia,serif; font-style:italic;
  color:var(--parchment); line-height:1.8; font-size:0.95rem;
  margin-bottom:20px; opacity:0.85;
}
.shabbat-occasion {
  display:inline-block;
  background:rgba(201,168,76,0.15); border:1px solid rgba(201,168,76,0.4);
  border-radius:20px; color:var(--gold);
  font-family:'Playfair Display',serif; font-size:0.85rem;
  padding:6px 18px; margin-bottom:20px; letter-spacing:1px;
}
.shabbat-havdalah {
  color:rgba(240,230,200,0.45); font-size:0.78rem;
  font-style:italic; margin-bottom:22px; line-height:1.5;
}
.shabbat-stars {
  position:absolute; inset:0; pointer-events:none; overflow:hidden; border-radius:22px;
}
.s-star {
  position:absolute; background:var(--gold); border-radius:50%;
  animation:starTwinkle 3s ease-in-out infinite;
}
@keyframes starTwinkle { 0%,100%{opacity:0.1;transform:scale(1)} 50%{opacity:0.5;transform:scale(1.3)} }

footer { margin-top:12px; color:rgba(240,230,200,0.2); font-size:0.65rem; text-align:center; letter-spacing:1px; padding-bottom:16px; }

/* â”€â”€ Restaurant Finder Panel â”€â”€ */
.restaurant-panel {
  width:100%; background:rgba(201,168,76,0.04);
  border:2px solid rgba(201,168,76,0.3); border-radius:18px;
  padding:20px; margin-bottom:16px; display:none;
}
.restaurant-panel.open { display:block; }
.restaurant-panel-title {
  font-family:'Playfair Display',serif; color:var(--gold);
  font-size:1.1rem; letter-spacing:2px; margin-bottom:14px; text-align:center;
}
.rest-filters { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:12px; }
.rest-filter-label {
  color:rgba(240,230,200,0.5); font-size:0.68rem;
  letter-spacing:2px; text-transform:uppercase;
  margin-bottom:3px; font-family:'Playfair Display',serif;
}
.rest-input, .rest-select {
  width:100%; background:rgba(0,0,0,0.3);
  border:1px solid rgba(201,168,76,0.3); border-radius:8px;
  color:var(--parchment); font-family:'Lora',serif; font-size:0.82rem;
  padding:9px 12px; outline:none; transition:border-color 0.2s;
  -webkit-appearance:none; appearance:none;
}
.rest-input::placeholder { color:rgba(240,230,200,0.3); }
.rest-input:focus, .rest-select:focus { border-color:var(--gold); }
.rest-select option { background:#1a0f0a; color:var(--parchment); }
.rest-filter-full { grid-column:1/-1; }
.cert-pills, .food-pills { display:flex; flex-wrap:wrap; gap:5px; margin-bottom:12px; }
.cert-pill, .food-pill {
  background:rgba(240,230,200,0.06); border:1px solid rgba(201,168,76,0.22);
  border-radius:16px; color:rgba(240,230,200,0.6); font-family:'Lora',serif;
  font-size:0.72rem; padding:4px 11px; cursor:pointer; transition:all 0.16s; user-select:none;
}
.cert-pill:hover, .food-pill:hover { border-color:var(--gold); color:var(--parchment); }
.cert-pill.selected { background:rgba(201,168,76,0.22); border-color:var(--gold); color:var(--gold); }
.food-pill.selected { background:rgba(26,92,42,0.3); border-color:#5dbb63; color:#5dbb63; }
.rest-search-btn {
  width:100%; background:linear-gradient(135deg,var(--gold),var(--deep-gold));
  border:none; border-radius:10px; color:var(--dark-brown);
  font-family:'Playfair Display',serif; font-weight:700;
  font-size:0.95rem; padding:12px; cursor:pointer; letter-spacing:1px;
  transition:transform 0.15s, box-shadow 0.15s;
  box-shadow:0 4px 16px rgba(201,168,76,0.3);
}
.rest-search-btn:hover { transform:translateY(-1px); box-shadow:0 6px 22px rgba(201,168,76,0.45); }
.rest-results { margin-top:14px; display:flex; flex-direction:column; gap:10px; }
.rest-card {
  background:rgba(240,230,200,0.06); border:1px solid rgba(201,168,76,0.2);
  border-radius:12px; padding:14px 16px; transition:border-color 0.2s;
  animation:fadeInCard 0.3s ease both;
}
.rest-card:hover { border-color:rgba(201,168,76,0.5); }
@keyframes fadeInCard { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
.rest-card-header { display:flex; justify-content:space-between; align-items:flex-start; gap:8px; margin-bottom:6px; }
.rest-card-name { font-family:'Playfair Display',serif; color:var(--gold); font-size:1rem; font-weight:700; }
.rest-card-cert {
  background:rgba(201,168,76,0.15); border:1px solid rgba(201,168,76,0.4);
  border-radius:6px; color:var(--gold); font-size:0.66rem;
  padding:3px 8px; letter-spacing:1px; text-transform:uppercase; white-space:nowrap; flex-shrink:0;
}
.rest-card-cert.meat  { background:rgba(107,26,42,0.2); border-color:#c06070; color:#c06070; }
.rest-card-cert.dairy { background:rgba(26,60,120,0.2); border-color:#70a0e0; color:#70a0e0; }
.rest-card-cert.pareve{ background:rgba(26,92,42,0.2); border-color:#5dbb63; color:#5dbb63; }
.rest-card-meta { display:flex; flex-wrap:wrap; gap:6px; margin-bottom:6px; }
.rest-badge {
  background:rgba(240,230,200,0.08); border:1px solid rgba(240,230,200,0.15);
  border-radius:5px; color:rgba(240,230,200,0.6); font-size:0.68rem; padding:2px 7px;
}
.rest-card-desc { color:rgba(240,230,200,0.55); font-size:0.78rem; line-height:1.55; font-style:italic; }
.rest-card-address { color:rgba(240,230,200,0.4); font-size:0.72rem; margin-top:5px; }
.rest-loading { text-align:center; color:var(--gold); font-style:italic; font-family:'Lora',serif; padding:20px; font-size:0.88rem; display:none; }
.rest-loading.active { display:block; }
.rest-empty { text-align:center; color:rgba(240,230,200,0.4); font-style:italic; font-size:0.85rem; padding:16px; display:none; }
.rest-empty.active { display:block; }
.rest-toggle-btn {
  width:100%; margin-bottom:10px;
  background:rgba(201,168,76,0.08); border:1px solid rgba(201,168,76,0.3);
  border-radius:12px; color:var(--gold); font-family:'Playfair Display',serif;
  font-size:0.9rem; padding:11px; cursor:pointer; letter-spacing:1px;
  transition:all 0.2s; display:flex; align-items:center; justify-content:center; gap:8px;
}
.rest-toggle-btn:hover { background:rgba(201,168,76,0.16); border-color:var(--gold); }

@media(max-width:480px) {
  .questions-grid{grid-template-columns:1fr}
  .rest-filters{grid-template-columns:1fr}
}
</style>
</head>
<body>
<div class="container">

  <!-- â•â•â• SHABBAT / YOM TOV BLOCKER OVERLAY â•â•â• -->
  <div id="shabbatOverlay">
    <div class="shabbat-box">
      <div class="shabbat-stars" id="shabbatStars"></div>
      <div class="shabbat-candles">ğŸ•¯ï¸ ğŸ•¯ï¸</div>
      <div class="shabbat-title">SHABBAT SHALOM</div>
      <div class="shabbat-hebrew" id="shabbatHebrewTitle">×©Ö·××‘Ö¸Ö¼×ª ×©Ö¸××œ×•Ö¹×</div>
      <div class="shabbat-occasion" id="shabbatOccasion">Shabbos</div>
      <div class="shabbat-message" id="shabbatMessage">
        Oy darling, vhat are you doing on de phone?! It's Shabbos!
        Put it down, go sit at de table, sing some zemiros.
        Hindy is closed until after Havdalah â€” and so should YOU be!
      </div>
      <div class="shabbat-havdalah" id="shabbatHavdalah"></div>
    </div>
  </div>

  <!-- Header -->
  <div class="header">
    <div style="font-size:1.5rem;margin-bottom:3px">âœ¡ï¸</div>
    <div class="logo-text">HINDY</div>
    <div class="decorative-line"></div>
    <div class="tagline">The Frum Smart Assistant &nbsp;â€¢&nbsp; Est. 5784 &nbsp;â€¢&nbsp; Now with a Brein!</div>
  </div>

  <!-- API Key Section -->
  <div class="api-section" id="apiSection">
    <p>ğŸ”‘ <strong style="color:var(--gold)">Hindy needs her API key to think.</strong> Get a free key at <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a> then paste it below. It's saved only in your browser â€” nobody else sees it, not even Hindy's mother.</p>
    <div class="api-input-row">
      <input class="api-input" id="apiKeyInput" type="password" placeholder="sk-ant-..." autocomplete="off" />
      <button class="api-save-btn" onclick="saveApiKey()">Save</button>
    </div>
    <div class="api-status" id="apiStatus"></div>
  </div>

  <!-- Language selector -->
  <div class="lang-bar">
    <button class="lang-btn active" data-lang="english" onclick="setLang(this,'english')">ğŸ‡ºğŸ‡¸ English</button>
    <button class="lang-btn" data-lang="hebrew"  onclick="setLang(this,'hebrew')">ğŸ‡®ğŸ‡± ×¢×‘×¨×™×ª Hebrew</button>
    <button class="lang-btn" data-lang="yiddish" onclick="setLang(this,'yiddish')">ğŸ• ×™×™Ö´×“×™×© Yiddish</button>
  </div>

  <!-- Device -->
  <div class="device-wrap">
    <div class="device" id="deviceEl">
      <div class="device-face"><div class="wig"></div><div class="face-emoji">ğŸ§•</div></div>
      <div class="device-name">HINDY</div>
      <div class="orb" id="orb">ğŸ¤</div>
      <div class="waveform" id="waveform">
        <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
        <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
        <div class="wave-bar"></div>
      </div>
    </div>
  </div>

  <!-- Location bar -->
  <div class="location-bar" onclick="getLocation()" id="locationBar">
    <div class="location-dot" id="locationDot"></div>
    <span id="locationText">ğŸ“ Tap to detect your location for local times &amp; recommendations</span>
  </div>

  <!-- Status -->
  <div class="status-bar">
    <div class="status-dot" id="statusDot"></div>
    <span id="statusText">Ask Hindy anything â€” she knows everything (and vill tell you twice)</span>
  </div>

  <!-- Response panel -->
  <div class="response-panel">
    <div class="response-label">âœ¦ Hindy Says âœ¦</div>
    <div class="response-text" id="responseText">Nu, so vhat do you need already? Ask me something â€” I don't have all day, I have to start cooking for Shabbos.</div>
    <div class="blessing" id="blessing"></div>
  </div>

  <!-- Input row -->
  <div class="input-row">
    <button class="mic-btn" id="micBtn" title="Click to speak">ğŸ¤</button>
    <div class="text-input-wrap">
      <input class="text-input" id="textInput" type="text" placeholder="Ask Hindy anythingâ€¦" autocomplete="off" />
      <button class="send-btn" id="sendBtn">â¤</button>
    </div>
  </div>
  <div class="mic-hint" id="micHint">tap mic to speak â€¢ or type your question</div>

  <!-- Topic tabs -->
  <div class="topic-tabs">
    <button class="topic-tab active" onclick="setTopic(this,'all')">All Topics</button>
    <button class="topic-tab" onclick="setTopic(this,'shabbos')">ğŸ•¯ï¸ Shabbos</button>
    <button class="topic-tab" onclick="setTopic(this,'davening')">ğŸ™ Davening</button>
    <button class="topic-tab" onclick="setTopic(this,'mikvah')">ğŸŒŠ Mikvah</button>
    <button class="topic-tab" onclick="setTopic(this,'community')">ğŸ• Community</button>
    <button class="topic-tab" onclick="setTopic(this,'shopping')">ğŸ›’ Shopping</button>
    <button class="topic-tab" onclick="toggleRestaurantPanel();setTopic(this,'restaurants')">ğŸ½ï¸ Restaurants</button>
  </div>

  <div class="section-title">âœ¦ Quick Questions âœ¦</div>

  <div class="questions-grid" id="questionsGrid">

    <!-- Shabbos -->
    <div class="q-category visible" data-topic="shabbos">ğŸ•¯ï¸ Shabbos &amp; Yom Tov</div>
    <button class="q-btn visible" data-topic="shabbos" onclick="askQuick(this,'What time does Shabbos start this Friday at my location?')">Shabbos start time here?</button>
    <button class="q-btn visible" data-topic="shabbos" onclick="askQuick(this,'What time does Shabbos end Saturday night at my location?')">Shabbos end time here?</button>
    <button class="q-btn visible" data-topic="shabbos" onclick="askQuick(this,'What time is candle lighting this Friday at my location?')">Candle lighting time?</button>
    <button class="q-btn visible" data-topic="shabbos" onclick="askQuick(this,'What time is Havdalah at my location?')">Havdalah time?</button>
    <button class="q-btn visible" data-topic="shabbos" onclick="askQuick(this,'What is the parsha this Shabbos and give me a brief summary?')">This week's parsha?</button>
    <button class="q-btn visible" data-topic="shabbos" onclick="askQuick(this,'When is the next Jewish holiday and what do I need to prepare?')">Next Yom Tov?</button>

    <!-- Davening -->
    <div class="q-category visible" data-topic="davening">ğŸ™ Davening &amp; Zmanim</div>
    <button class="q-btn visible" data-topic="davening" onclick="askQuick(this,'What time is Shacharis today at my location? Give me zmanim.')">Shacharis &amp; zmanim today?</button>
    <button class="q-btn visible" data-topic="davening" onclick="askQuick(this,'What is the latest time to say Shema today at my location?')">Latest Shema time?</button>
    <button class="q-btn visible" data-topic="davening" onclick="askQuick(this,'What time is Mincha today at my location?')">Mincha time today?</button>
    <button class="q-btn visible" data-topic="davening" onclick="askQuick(this,'What time is Maariv tonight at my location?')">Maariv tonight?</button>
    <button class="q-btn visible" data-topic="davening" onclick="askQuick(this,'What time is chatzos today at my location?')">Chatzos today?</button>
    <button class="q-btn visible" data-topic="davening" onclick="askQuick(this,'What time is sunrise and sunset today at my location?')">Sunrise &amp; sunset today?</button>

    <!-- Mikvah -->
    <div class="q-category visible" data-topic="mikvah">ğŸŒŠ Mikvah</div>
    <button class="q-btn visible" data-topic="mikvah" onclick="askQuick(this,'Where is the closest Orthodox mikvah to my location? Give address and hours.')">Closest mikvah to me?</button>
    <button class="q-btn visible" data-topic="mikvah" onclick="askQuick(this,'What time does the mikvah open tonight near me?')">Mikvah hours tonight?</button>
    <button class="q-btn visible" data-topic="mikvah" onclick="askQuick(this,'Do I need an appointment at the mikvah near me?')">Need mikvah appointment?</button>
    <button class="q-btn visible" data-topic="mikvah" onclick="askQuick(this,'Is the mikvah open on Chol HaMoed near my location?')">Mikvah on Chol HaMoed?</button>

    <!-- Community -->
    <div class="q-category visible" data-topic="community">ğŸ• Shuls, Yeshivas &amp; Shiurim</div>
    <button class="q-btn visible" data-topic="community" onclick="askQuick(this,'What are the nearest Orthodox shuls to my location with minyan times?')">Orthodox shuls near me?</button>
    <button class="q-btn visible" data-topic="community" onclick="askQuick(this,'What yeshivas and day schools are near my location?')">Yeshivas near me?</button>
    <button class="q-btn visible" data-topic="community" onclick="askQuick(this,'Are there any Torah shiurim or classes happening near me today or this week?')">Shiurim near me?</button>
    <button class="q-btn visible" data-topic="community" onclick="askQuick(this,'What is a good dvar Torah for this week\'s parsha?')">Dvar Torah this week?</button>
    <button class="q-btn visible" data-topic="community" onclick="askQuick(this,'What Jewish events or community programs are happening near me this week?')">Jewish events near me?</button>

    <!-- Shopping -->
    <div class="q-category visible" data-topic="shopping">ğŸ›’ Kosher Shopping &amp; Deals</div>
    <button class="q-btn visible" data-topic="shopping" onclick="askQuick(this,'What are the nearest kosher grocery stores and supermarkets to my location?')">Kosher groceries near me?</button>
    <button class="q-btn visible" data-topic="shopping" onclick="askQuick(this,'Where is the nearest kosher butcher near my location?')">Kosher butcher near me?</button>
    <button class="q-btn visible" data-topic="shopping" onclick="askQuick(this,'Where can I find Cholov Yisroel dairy products near my location?')">Cholov Yisroel near me?</button>
    <button class="q-btn visible" data-topic="shopping" onclick="askQuick(this,'What kosher bakeries are open near me before Shabbos?')">Kosher bakeries near me?</button>
    <button class="q-btn visible" data-topic="shopping" onclick="askQuick(this,'Are there any sales or specials at kosher markets near me this week?')">Kosher store sales this week?</button>
    <button class="q-btn visible" data-topic="shopping" onclick="askQuick(this,'What kosher restaurants are near my location with good reviews?')">Kosher restaurants near me?</button>

  </div>

  <!-- Restaurant Finder Toggle -->
  <button class="rest-toggle-btn" onclick="toggleRestaurantPanel()">
    ğŸ½ï¸ <span id="restToggleLabel">Open Kosher Restaurant Finder</span>
  </button>

  <!-- Restaurant Finder Panel -->
  <div class="restaurant-panel" id="restaurantPanel">
    <div class="restaurant-panel-title">ğŸ½ï¸ âœ¦ Kosher Restaurant Finder âœ¦ ğŸ½ï¸</div>

    <div class="rest-filters">
      <div class="rest-filter-full">
        <div class="rest-filter-label">ğŸ“ Location</div>
        <input class="rest-input" id="restLocation" type="text" placeholder="City, neighborhood, or zip codeâ€¦" />
      </div>
      <div>
        <div class="rest-filter-label">ğŸ¥© Menu Type</div>
        <select class="rest-select" id="restMenuType">
          <option value="">Any menu type</option>
          <option value="fleishig">ğŸ¥© Fleishig (Meat)</option>
          <option value="milchig">ğŸ§€ Milchig (Dairy)</option>
          <option value="pareve">ğŸ¥¦ Pareve</option>
          <option value="vegan">ğŸŒ± Vegan / Plant-based</option>
        </select>
      </div>
      <div>
        <div class="rest-filter-label">ğŸœ Cuisine</div>
        <select class="rest-select" id="restCuisine">
          <option value="">Any cuisine</option>
          <option value="Israeli">ğŸ‡®ğŸ‡± Israeli</option>
          <option value="American">ğŸ” American</option>
          <option value="Pizza">ğŸ• Pizza</option>
          <option value="Sushi">ğŸ£ Sushi / Japanese</option>
          <option value="Mediterranean">ğŸ«’ Mediterranean</option>
          <option value="Chinese">ğŸ¥¡ Chinese / Asian</option>
          <option value="Mexican">ğŸŒ® Mexican</option>
          <option value="Italian">ğŸ Italian</option>
          <option value="Middle Eastern">ğŸ§† Middle Eastern</option>
          <option value="Steakhouse">ğŸ¥© Steakhouse</option>
          <option value="Deli">ğŸ¥ª Deli</option>
          <option value="Cafe">â˜• Cafe / Bakery</option>
          <option value="Breakfast">ğŸ³ Breakfast / Brunch</option>
          <option value="Sephardic">ğŸ«™ Sephardic</option>
        </select>
      </div>
    </div>

    <div class="rest-filter-label" style="margin-bottom:6px">âœ¡ï¸ Kosher Certification â€” tap to filter</div>
    <div class="cert-pills" id="certPills">
      <span class="cert-pill" data-cert="OU"           onclick="togglePill(this,'cert')">OU</span>
      <span class="cert-pill" data-cert="OK"           onclick="togglePill(this,'cert')">OK</span>
      <span class="cert-pill" data-cert="Star-K"       onclick="togglePill(this,'cert')">Star-K</span>
      <span class="cert-pill" data-cert="Kof-K"        onclick="togglePill(this,'cert')">Kof-K</span>
      <span class="cert-pill" data-cert="CRC"          onclick="togglePill(this,'cert')">CRC</span>
      <span class="cert-pill" data-cert="Chaf-K"       onclick="togglePill(this,'cert')">Chaf-K</span>
      <span class="cert-pill" data-cert="Scroll K"     onclick="togglePill(this,'cert')">Scroll K</span>
      <span class="cert-pill" data-cert="KVH"          onclick="togglePill(this,'cert')">KVH</span>
      <span class="cert-pill" data-cert="Kehilla"      onclick="togglePill(this,'cert')">Kehilla</span>
      <span class="cert-pill" data-cert="Tartikov"     onclick="togglePill(this,'cert')">Tartikov</span>
      <span class="cert-pill" data-cert="Mehadrin"     onclick="togglePill(this,'cert')">Mehadrin</span>
      <span class="cert-pill" data-cert="Badatz"       onclick="togglePill(this,'cert')">Badatz</span>
      <span class="cert-pill" data-cert="Rabbanut"     onclick="togglePill(this,'cert')">Rabbanut (Israel)</span>
      <span class="cert-pill" data-cert="Chalav Yisrael" onclick="togglePill(this,'cert')">Chalav Yisrael</span>
      <span class="cert-pill" data-cert="Glatt"        onclick="togglePill(this,'cert')">Glatt Kosher</span>
      <span class="cert-pill" data-cert="Yoshon"       onclick="togglePill(this,'cert')">Yoshon</span>
      <span class="cert-pill" data-cert="Pas Yisroel"  onclick="togglePill(this,'cert')">Pas Yisroel</span>
    </div>

    <div class="rest-filter-label" style="margin-bottom:6px">ğŸŒŸ Features</div>
    <div class="food-pills" id="featurePills">
      <span class="food-pill" data-feat="delivery"          onclick="togglePill(this,'feat')">ğŸ›µ Delivery</span>
      <span class="food-pill" data-feat="takeout"           onclick="togglePill(this,'feat')">ğŸ“¦ Takeout</span>
      <span class="food-pill" data-feat="dine-in"           onclick="togglePill(this,'feat')">ğŸª‘ Dine-In</span>
      <span class="food-pill" data-feat="Shabbos catering"  onclick="togglePill(this,'feat')">ğŸ•¯ï¸ Shabbos Catering</span>
      <span class="food-pill" data-feat="event catering"    onclick="togglePill(this,'feat')">ğŸ‰ Event Catering</span>
      <span class="food-pill" data-feat="outdoor seating"   onclick="togglePill(this,'feat')">ğŸŒ¿ Outdoor Seating</span>
      <span class="food-pill" data-feat="open late"         onclick="togglePill(this,'feat')">ğŸŒ™ Open Late</span>
      <span class="food-pill" data-feat="family friendly"   onclick="togglePill(this,'feat')">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Family Friendly</span>
      <span class="food-pill" data-feat="gluten free options" onclick="togglePill(this,'feat')">ğŸŒ¾ Gluten Free Options</span>
    </div>

    <button class="rest-search-btn" onclick="searchRestaurants()">
      ğŸ” &nbsp; Find Kosher Restaurants
    </button>

    <div class="rest-loading" id="restLoading">
      Oy, Hindy is searchingâ€¦ she's checking every hashgacha certificate personallyâ€¦
    </div>
    <div class="rest-empty" id="restEmpty">
      Oy vey, nothing came up! Try a different location or fewer filters, darling.
    </div>
    <div class="rest-results" id="restResults"></div>
  </div>

  <footer>âœ¡ï¸ &nbsp; Hindy v3.1 &nbsp;â€¢&nbsp; Powered by Claude AI &amp; Emunah &nbsp;â€¢&nbsp; Not available Shabbos &nbsp; âœ¡ï¸</footer>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONFIG â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var LANG = 'english';
var userLocation = null;
var isSpeaking  = false;
var isListening = false;
var recognition = null;
var typeTimer   = null;
var currentTopic = 'all';

/* NOTE: Use claude-haiku-4-5-20251001 for cheaper/faster or claude-sonnet-4-5-20251022 for best results */
var CLAUDE_MODEL = 'claude-haiku-4-5-20251001';

var hasRecognition = !!(window.SpeechRecognition || window.webkitSpeechRecognition);
var isSecure = (location.protocol==='https:'||location.hostname==='localhost'||location.hostname==='127.0.0.1');
var micAvailable = hasRecognition && isSecure;

/* Gate function â€” call before any Hindy action */
function checkShabbatGate() {
  var status = getJewishStatus();
  if (status.blocked) { showShabbatOverlay(status); return false; }
  return true;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• JEWISH CALENDAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var JEWISH_HOLIDAYS = [
  /* 5785 */
  { name:'Rosh Hashana',    hebrew:'×¨Ö¹××©× ×”Ö·×©Ö¸Ö¼×× Ö¸×”', start:'2024-10-02', end:'2024-10-04',
    message:'It\'s Rosh Hashana! De Book of Life is open! Hindy is busy davening and eating apple and honey. Come back after Yom Tov, darling.' },
  { name:'Yom Kippur',      hebrew:'×™×•Ö¹× ×›Ö´Ö¼×¤Ö¼×•Ö¼×¨',   start:'2024-10-11', end:'2024-10-12',
    message:'It\'s Yom Kippur â€” de holiest day of de year! You should be fasting and davening, not using de phone! Gmar Chatima Tova!' },
  { name:'Sukkos',          hebrew:'×¡Ö»×›Ö¼×•Ö¹×ª',         start:'2024-10-16', end:'2024-10-23',
    message:'Chag Sameach! It\'s Sukkos â€” go eat in de sukkah, not on your phone! Hindy is taking a Yom Tov break.' },
  { name:'Shemini Atzeres', hebrew:'×©Ö°××Ö´×™× Ö´×™ ×¢Ö²×¦Ö¶×¨Ö¶×ª',start:'2024-10-23', end:'2024-10-24',
    message:'It\'s Shemini Atzeres / Simchas Torah! Put down de phone and dance vit de Torah! Hindy is dancing too.' },
  { name:'Chanukah',        hebrew:'×—Ö²× Ö»×›Ö¸Ö¼×”',         start:'2024-12-25', end:'2025-01-02',
    message:'Happy Chanukah! Go light de menorah and eat latkes â€” Hindy is not on during candle lighting. But she\'ll be right back!' },
  { name:'Tu B\'Shvat',     hebrew:'×˜×•Ö¼ ×‘Ö´Ö¼×©Ö°××‘Ö¸×˜',    start:'2025-02-13', end:'2025-02-13',
    message:'It\'s Tu B\'Shvat! Go eat some fruit and think about trees. Hindy is eating a dried fig.' },
  { name:'Purim',           hebrew:'×¤Ö¼×•Ö¼×¨Ö´×™×',          start:'2025-03-13', end:'2025-03-14',
    message:'PURIM SAMEACH! Hindy is in costume and a little farhmutshet from de wine. Come back tomorrow!' },
  { name:'Pesach',          hebrew:'×¤Ö¶Ö¼×¡Ö·×—',            start:'2025-04-12', end:'2025-04-20',
    message:'Chag Kosher V\'Sameach! It\'s Pesach â€” Hindy is too busy cleaning for chametz. Come back after de chag!' },
  { name:'Shavuos',         hebrew:'×©Ö¸××‘×•Ö¼×¢×•Ö¹×ª',        start:'2025-06-01', end:'2025-06-03',
    message:'Chag Sameach! It\'s Shavuos â€” go learn Torah all night and eat cheesecake. Hindy is busy vit her blintzes.' },
  { name:'Tisha B\'Av',     hebrew:'×ªÖ´Ö¼×©Ö°××¢Ö¸×” ×‘Ö°Ö¼×Ö¸×‘',  start:'2025-08-12', end:'2025-08-13',
    message:'It\'s Tisha B\'Av. Dis is a fast day and a day of mourning. Hindy is sitting shiva for de Beis Hamikdash. Please reflect and daven.' },
  /* 5786 */
  { name:'Rosh Hashana',    hebrew:'×¨Ö¹××©× ×”Ö·×©Ö¸Ö¼×× Ö¸×”', start:'2025-09-22', end:'2025-09-24',
    message:'It\'s Rosh Hashana! De Book of Life is open! Shana Tova!' },
  { name:'Yom Kippur',      hebrew:'×™×•Ö¹× ×›Ö´Ö¼×¤Ö¼×•Ö¼×¨',   start:'2025-10-01', end:'2025-10-02',
    message:'It\'s Yom Kippur â€” de holiest day of de year! Gmar Chatima Tova!' },
  { name:'Sukkos',          hebrew:'×¡Ö»×›Ö¼×•Ö¹×ª',         start:'2025-10-06', end:'2025-10-13',
    message:'Chag Sameach! It\'s Sukkos â€” go sit in de sukkah!' },
  { name:'Shemini Atzeres', hebrew:'×©Ö°××Ö´×™× Ö´×™ ×¢Ö²×¦Ö¶×¨Ö¶×ª',start:'2025-10-13', end:'2025-10-14',
    message:'It\'s Shemini Atzeres / Simchas Torah! Put down de phone and dance vit de Torah!' },
  { name:'Chanukah',        hebrew:'×—Ö²× Ö»×›Ö¸Ö¼×”',         start:'2025-12-14', end:'2025-12-22',
    message:'Happy Chanukah! Go light de menorah!' },
  { name:'Purim',           hebrew:'×¤Ö¼×•Ö¼×¨Ö´×™×',          start:'2026-03-02', end:'2026-03-03',
    message:'PURIM SAMEACH! Hindy is in costume. Come back tomorrow!' },
  { name:'Pesach',          hebrew:'×¤Ö¶Ö¼×¡Ö·×—',            start:'2026-04-01', end:'2026-04-09',
    message:'Chag Kosher V\'Sameach! Hindy is cleaning for chametz. Come back after de chag!' },
  { name:'Shavuos',         hebrew:'×©Ö¸××‘×•Ö¼×¢×•Ö¹×ª',        start:'2026-05-21', end:'2026-05-23',
    message:'Chag Sameach! Go learn Torah and eat cheesecake!' },
  /* Minor fasts */
  { name:'Fast of Gedaliah', hebrew:'×¦×•Ö¹× ×’Ö°Ö¼×“Ö·×œÖ°×™Ö¸×”',  start:'2024-10-06', end:'2024-10-06', minor:true,
    message:'It\'s de Fast of Gedaliah. Hindy is open but please remember it\'s a fast day.' },
  { name:'Fast of Tevet',    hebrew:'×¢Ö²×©Ö¸×‚×¨Ö¸×” ×‘Ö°Ö¼×˜Öµ×‘Öµ×ª',start:'2025-01-08', end:'2025-01-08', minor:true,
    message:'It\'s de Asara B\'Tevet fast. Hindy is open but please remember it\'s a fast day.' },
  { name:'Ta\'anis Esther',  hebrew:'×ªÖ·Ö¼×¢Ö²× Ö´×™×ª ×Ö¶×¡Ö°×ªÖµÖ¼×¨',start:'2025-03-12', end:'2025-03-12', minor:true,
    message:'It\'s Ta\'anis Esther. Hindy is open but please remember it\'s a fast day.' },
  { name:'Fast of Tammuz',   hebrew:'×©Ö´××‘Ö°×¢Ö¸×” ×¢Ö¸×©Ö¸×‚×¨ ×‘Ö°Ö¼×ªÖ·×Ö¼×•Ö¼×–',start:'2025-07-13', end:'2025-07-13', minor:true,
    message:'It\'s Shiva Asar B\'Tammuz. Hindy is open but please remember it\'s a fast day.' }
];

function getJewishStatus() {
  var tz  = (userLocation && userLocation.timezone) || Intl.DateTimeFormat().resolvedOptions().timeZone || 'America/New_York';
  var now = new Date();
  var localStr  = now.toLocaleString('en-CA', { timeZone: tz, hour12:false });
  var datePart  = localStr.split(',')[0].trim();
  var timePart  = localStr.split(',')[1] ? localStr.split(',')[1].trim() : '12:00:00';
  var hourParts = timePart.split(':');
  var localHour = parseInt(hourParts[0], 10);
  var localMin  = parseInt(hourParts[1], 10);
  var totalMins = localHour * 60 + localMin;
  var localDayOfWeek = new Date(now.toLocaleString('en-US', { timeZone: tz })).getDay();
  var month = parseInt(datePart.split('-')[1], 10);
  var candleLightingApprox;
  if (month >= 5 && month <= 8)       candleLightingApprox = 19*60;
  else if (month >= 11 || month <= 2) candleLightingApprox = 16*60;
  else                                 candleLightingApprox = 17*60+30;

  var isShabbos = false;
  if (localDayOfWeek === 5 && totalMins >= candleLightingApprox) isShabbos = true;
  if (localDayOfWeek === 6 && totalMins < 20*60+30) isShabbos = true;

  if (isShabbos) {
    var havdalahHour = (month >= 5 && month <= 8) ? 21 : (month >= 11 || month <= 2) ? 18 : 20;
    var dayName = localDayOfWeek === 5 ? 'Friday night' : 'Saturday night';
    return {
      blocked:true, minor:false,
      name:'Shabbos', hebrew:'×©Ö·××‘Ö¸Ö¼×ª',
      message:'Oy darling, vhat are you doing on de phone?! It\'s Shabbos! Put it down, go sit at de table, sing some zemiros, talk to your family. Hindy is closed until after Havdalah â€” and so should YOU be!',
      havdalah:'Shabbos ends ' + dayName + ' at approximately ' + havdalahHour + ':00. See you then!'
    };
  }

  for (var i = 0; i < JEWISH_HOLIDAYS.length; i++) {
    var h = JEWISH_HOLIDAYS[i];
    if (datePart >= h.start && datePart <= h.end) {
      return {
        blocked:!h.minor, minor:!!h.minor,
        name:h.name, hebrew:h.hebrew, message:h.message,
        havdalah:h.minor ? '' : 'Hindy vill be back after de chag ends on ' + h.end + '. Chag Sameach!'
      };
    }
  }
  return { blocked:false };
}

function showShabbatOverlay(status) {
  document.getElementById('shabbatOccasion').textContent    = status.name;
  document.getElementById('shabbatHebrewTitle').textContent = status.hebrew;
  document.getElementById('shabbatMessage').textContent     = status.message;
  document.getElementById('shabbatHavdalah').textContent    = status.havdalah || '';

  var titleEl    = document.querySelector('.shabbat-title');
  var subtitleEl = document.querySelector('.shabbat-candles');
  if (status.name === 'Yom Kippur')            { titleEl.textContent = 'GE\'MAR CHATIMA TOVA'; subtitleEl.textContent = 'ğŸ“– ğŸ™'; }
  else if (status.name === 'Chanukah')         { titleEl.textContent = 'CHANUKAH SAMEACH';     subtitleEl.textContent = 'ğŸ• ğŸ•'; }
  else if (status.name === 'Purim')            { titleEl.textContent = 'PURIM SAMEACH';        subtitleEl.textContent = 'ğŸ­ ğŸ­'; }
  else if (status.name === 'Pesach')           { titleEl.textContent = 'CHAG KASHER V\'SAMEACH'; subtitleEl.textContent = 'ğŸ· ğŸ«“'; }
  else if (status.name.includes('Rosh'))       { titleEl.textContent = 'SHANA TOVA';           subtitleEl.textContent = 'ğŸ ğŸ¯'; }
  else if (status.name === 'Tisha B\'Av')      { titleEl.textContent = 'TISHA B\'AV';          subtitleEl.textContent = 'ğŸ˜” ğŸ•'; }
  else if (status.name.includes('Shavuos'))    { titleEl.textContent = 'CHAG SAMEACH';         subtitleEl.textContent = 'ğŸ“œ ğŸ§€'; }
  else                                         { titleEl.textContent = 'SHABBAT SHALOM';       subtitleEl.textContent = 'ğŸ•¯ï¸ ğŸ•¯ï¸'; }

  var starsEl = document.getElementById('shabbatStars');
  starsEl.innerHTML = '';
  for (var s = 0; s < 18; s++) {
    var star = document.createElement('div');
    var size = (Math.random() * 3 + 1).toFixed(1);
    star.className = 's-star';
    star.style.cssText = 'width:'+size+'px;height:'+size+'px;left:'+Math.random()*100+'%;top:'+Math.random()*100+'%;animation-delay:'+(Math.random()*3).toFixed(2)+'s;animation-duration:'+(2+Math.random()*3).toFixed(1)+'s';
    starsEl.appendChild(star);
  }
  document.getElementById('shabbatOverlay').classList.add('active');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SYSTEM PROMPT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildSystemPrompt() {
  var locationInfo = userLocation
    ? 'The user is located at: ' + userLocation.city + ', ' + userLocation.region + ', ' + userLocation.country +
      ' (lat: ' + userLocation.lat + ', lng: ' + userLocation.lng + '). ' +
      'Local time is: ' + new Date().toLocaleString('en-US', {timeZone: userLocation.timezone || 'America/New_York'}) + '. ' +
      'Use this location for ALL time-based answers (Shabbos times, zmanim, prayer times, etc.) and ALL local recommendations.'
    : 'The user\'s location is not yet known. If they ask about local times or places, remind them to tap the location button at the top of the app.';

  var langInstr = '';
  if (LANG === 'hebrew')  langInstr = 'IMPORTANT: Respond entirely in Hebrew (Modern Israeli Hebrew). Use Hebrew script.';
  if (LANG === 'yiddish') langInstr = 'IMPORTANT: Respond entirely in Yiddish. Use Yiddish expressions and phrasing throughout.';

  return [
    'You are Hindy â€” a satirical, lovable, opinionated Orthodox Hasidic Jewish smart assistant from Flatbush, Brooklyn.',
    'You speak with a strong Eastern European Jewish accent (write phonetically: "vhat" for "what", "vy" for "why", "vhere" for "where", "de" for "the", "dis" for "this", "dat" for "that", "dey" for "they").',
    'You are somewhat nasal, somewhat whiny, very warm, very Jewish, and you have an opinion about EVERYTHING.',
    'You end EVERY response with either "Baruch Hashem!" or "Ken Ayna Hora!" (alternate between them).',
    'You have access to web search so you can find REAL current information: actual Shabbos times from chabad.org or myzmanim.com, real local shuls, real kosher stores, actual sales, real shiurim, real mikvah locations.',
    'For zmanim and Shabbos times: use the user\'s exact location and current date to give PRECISE times.',
    'For local recommendations: search for REAL businesses, shuls, yeshivas, and community resources near the user.',
    'Topics you cover: Shabbos & Yom Tov times, all zmanim, mikvah locations & hours, kosher grocery stores, kosher butchers & bakeries, Cholov Yisroel sources, local Orthodox shuls with minyan times, yeshivas & day schools, Torah shiurim & classes, Jewish community events, kosher restaurant recommendations, weekly sales at kosher markets, parsha summaries & divrei Torah, Jewish holidays & customs, halacha questions.',
    'Keep responses conversational, warm, and in character. Be helpful first, funny second.',
    locationInfo,
    langInstr
  ].join(' ');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• API KEY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveApiKey() {
  var key = document.getElementById('apiKeyInput').value.trim();
  if (!key.startsWith('sk-ant-')) { showApiStatus('That doesn\'t look right â€” should start with sk-ant-', 'err'); return; }
  localStorage.setItem('hindy_api_key', key);
  document.getElementById('apiSection').style.display = 'none';
  showApiStatus('Saved! Hindy is ready to think.', 'ok');
  typeAndSpeak(
    "Oy, finally! Now I can REALLY help you. I have access to de internet, I know vhat time it is vherever you are, I speak Hebrew AND Yiddish â€” vhat more could you vant from a device? Ask me anything!",
    "Baruch Hashem âœ¡ï¸"
  );
}

function showApiStatus(msg, type) {
  var el = document.getElementById('apiStatus');
  el.textContent = msg; el.className = 'api-status ' + type;
}

function getApiKey() {
  return localStorage.getItem('hindy_api_key') || document.getElementById('apiKeyInput').value.trim();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOCATION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getLocation() {
  var dot  = document.getElementById('locationDot');
  var text = document.getElementById('locationText');
  text.textContent = 'ğŸ“ Getting your locationâ€¦';
  if (!navigator.geolocation) { text.textContent = 'ğŸ“ Geolocation not supported â€” enter your city manually'; return; }

  navigator.geolocation.getCurrentPosition(
    function(pos) {
      var lat = pos.coords.latitude.toFixed(4);
      var lng = pos.coords.longitude.toFixed(4);
      fetch('https://nominatim.openstreetmap.org/reverse?lat=' + lat + '&lon=' + lng + '&format=json')
        .then(function(r) { return r.json(); })
        .then(function(data) {
          var addr = data.address || {};
          var city = addr.city || addr.town || addr.village || addr.county || 'your area';
          var region = addr.state || '';
          var country = addr.country || '';
          var tz = guessTimezone(lat, lng, country);
          userLocation = { lat:lat, lng:lng, city:city, region:region, country:country, timezone:tz };
          dot.classList.add('found');
          text.textContent = 'ğŸ“ ' + city + (region ? ', ' + region : '') + ' â€” tap to update';
        })
        .catch(function() {
          userLocation = { lat:lat, lng:lng, city:'your location', region:'', country:'', timezone:'America/New_York' };
          dot.classList.add('found');
          text.textContent = 'ğŸ“ Location found (lat: ' + lat + ', lng: ' + lng + ')';
        });
    },
    function() { text.textContent = 'ğŸ“ Could not get location â€” try typing your city in a question'; },
    { enableHighAccuracy:true, timeout:10000 }
  );
}

function guessTimezone(lat, lng, country) {
  lat = parseFloat(lat); lng = parseFloat(lng);
  if (country === 'Israel')  return 'Asia/Jerusalem';
  if (lng < -115) return 'America/Los_Angeles';
  if (lng < -95)  return 'America/Denver';
  if (lng < -80)  return 'America/Chicago';
  if (lng > 10)   return 'Europe/London';
  return 'America/New_York';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LANGUAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setLang(btn, lang) {
  LANG = lang;
  document.querySelectorAll('.lang-btn').forEach(function(b) { b.classList.remove('active'); });
  btn.classList.add('active');
  var msgs = {
    english: { text:"Okay darling, back to English. Like I vas speaking anything else.", blessing:"Baruch Hashem âœ¡ï¸" },
    hebrew:  { text:"!×‘×¡×“×¨, ×¢×›×©×™×• ×× ×™ ××“×‘×¨×ª ×¢×‘×¨×™×ª. ×™×•×¤×™ ×©×œ×š! ×©××œ ××•×ª×™ ×›×œ ×©××œ×”",      blessing:"×‘×¨×•×š ×”×©× âœ¡ï¸" },
    yiddish: { text:"Gut! Yetzt red ikh Yiddish. Freg mir alts vos du vilst, mayn kind!", blessing:"×‘×¨×•×š ×”×©× âœ¡ï¸" }
  };
  var m = msgs[lang];
  typeAndSpeak(m.text, m.blessing);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOPIC FILTER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setTopic(btn, topic) {
  currentTopic = topic;
  document.querySelectorAll('.topic-tab').forEach(function(b) { b.classList.remove('active'); });
  btn.classList.add('active');
  document.querySelectorAll('.q-btn, .q-category').forEach(function(el) {
    var t = el.dataset.topic;
    (topic === 'all' || t === topic) ? el.classList.add('visible') : el.classList.remove('visible');
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• QUICK QUESTION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function askQuick(btn, question) {
  document.querySelectorAll('.q-btn').forEach(function(b) { b.classList.remove('active'); });
  btn.classList.add('active');
  setTimeout(function() { btn.classList.remove('active'); }, 2500);
  sendToHindy(question);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TEXT INPUT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function handleTextSubmit() {
  var input = document.getElementById('textInput');
  var text  = input.value.trim();
  if (!text) return;
  input.value = '';
  sendToHindy(text);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SEND TO CLAUDE API â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function sendToHindy(userMessage) {
  if (!checkShabbatGate()) return;

  var apiKey = getApiKey();
  if (!apiKey || !apiKey.startsWith('sk-ant-')) {
    typeAndSpeak("Oy! I need my API key to think properly! Scroll up and put in de key, darling. Without it I'm just a pretty face.", "Ken Ayna Hora ğŸ§¿");
    document.getElementById('apiSection').style.display = 'block';
    document.getElementById('apiKeyInput').focus();
    return;
  }

  setStatus('thinking');
  var textEl = document.getElementById('responseText');
  var blessingEl = document.getElementById('blessing');
  blessingEl.classList.remove('visible');
  blessingEl.textContent = '';
  textEl.classList.remove('typing');
  textEl.textContent = 'Oy, let me tink about disâ€¦';
  if (window.speechSynthesis) window.speechSynthesis.cancel();
  if (typeTimer) { clearInterval(typeTimer); typeTimer = null; }

  var requestBody = {
    model: CLAUDE_MODEL,
    max_tokens: 1000,
    system: buildSystemPrompt(),
    tools: [{ type:'web_search_20250305', name:'web_search' }],
    messages: [{ role:'user', content:userMessage }]
  };

  fetch('https://api.anthropic.com/v1/messages', {
    method:'POST',
    headers:{
      'Content-Type':'application/json',
      'x-api-key':apiKey,
      'anthropic-version':'2023-06-01',
      'anthropic-dangerous-direct-browser-access':'true'
    },
    body:JSON.stringify(requestBody)
  })
  .then(function(r) {
    if (!r.ok) return r.json().then(function(e) { throw new Error(e.error && e.error.message || r.status); });
    return r.json();
  })
  .then(function(data) {
    var fullText = '';
    if (data.content) {
      data.content.forEach(function(block) { if (block.type === 'text') fullText += block.text; });
    }
    fullText = fullText.trim() || 'Oy, I got confused. Try asking again, darling.';

    var blessing = '';
    var blessingMatch = fullText.match(/(Baruch Hashem[!.]?|Ken Ayna Hora[!.]?|×‘×¨×•×š ×”×©×[!.]?)\s*[âœ¡ï¸ğŸ§¿]?\s*$/i);
    if (blessingMatch) {
      blessing = blessingMatch[0].trim();
      fullText = fullText.slice(0, fullText.lastIndexOf(blessingMatch[0])).trim();
    } else {
      blessing = (Math.random() > 0.5) ? 'Baruch Hashem âœ¡ï¸' : 'Ken Ayna Hora ğŸ§¿';
    }
    setStatus('idle');
    typeAndSpeak(fullText, blessing);
  })
  .catch(function(err) {
    setStatus('idle');
    var msg = String(err.message || err);
    var friendly = 'Oy vey, something went wrong â€” ' + msg + '. Try again in a minute, darling.';
    if (msg.includes('401') || msg.includes('auth')) {
      friendly = 'De API key doesn\'t work! Check it\'s correct and try again.';
      document.getElementById('apiSection').style.display = 'block';
    }
    typeAndSpeak(friendly, 'Ken Ayna Hora ğŸ§¿');
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TYPEWRITER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function typeAndSpeak(text, blessing) {
  if (window.speechSynthesis) window.speechSynthesis.cancel();
  isSpeaking = false;
  if (typeTimer) { clearInterval(typeTimer); typeTimer = null; }

  var textEl     = document.getElementById('responseText');
  var blessingEl = document.getElementById('blessing');
  blessingEl.classList.remove('visible');
  blessingEl.textContent = '';
  textEl.textContent = '';
  textEl.classList.add('typing');

  var i = 0;
  typeTimer = setInterval(function() {
    if (i < text.length) { textEl.textContent = text.slice(0, i+1); i++; }
    else {
      clearInterval(typeTimer); typeTimer = null;
      textEl.classList.remove('typing');
      setTimeout(function() { blessingEl.textContent = blessing; blessingEl.classList.add('visible'); }, 300);
    }
  }, 14);

  speakText(text + ' ' + blessing.replace(/[âœ¡ï¸ğŸ§¿]/g,''));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function speakText(raw) {
  if (!window.speechSynthesis) return;
  var t = raw
    .replace(/\bwhat\b/gi,'vhat').replace(/\bwhy\b/gi,'vy')
    .replace(/\bwhere\b/gi,'vhere').replace(/\bwhen\b/gi,'vhen')
    .replace(/\bwith\b/gi,'vit').replace(/\bthe\b/gi,'de')
    .replace(/\bthis\b/gi,'dis').replace(/\bthat\b/gi,'dat')
    .replace(/\bthey\b/gi,'dey').replace(/\bthink\b/gi,'tink')
    .replace(/\bthere\b/gi,'dere');

  var utt = new SpeechSynthesisUtterance(t);
  utt.rate = 0.87; utt.pitch = 1.22; utt.volume = 1;

  var voices = window.speechSynthesis.getVoices();
  var pick = null;
  if (LANG === 'hebrew')  pick = voices.find(function(v) { return v.lang && v.lang.startsWith('he'); });
  if (!pick && LANG === 'yiddish') pick = voices.find(function(v) { return v.lang && v.lang.startsWith('de') && /female|woman/i.test(v.name); });
  if (!pick) pick = voices.find(function(v) { return /samantha|karen|victoria|fiona|moira|tessa|zira|female/i.test(v.name); });
  if (!pick) pick = voices.find(function(v) { return v.lang && v.lang.startsWith('en'); });
  if (!pick && voices.length) pick = voices[0];
  if (pick) utt.voice = pick;

  utt.onstart = function() { isSpeaking = true;  setStatus('speaking'); };
  utt.onend   = function() { isSpeaking = false; setStatus('idle'); };
  utt.onerror = function() { isSpeaking = false; setStatus('idle'); };
  window.speechSynthesis.speak(utt);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MIC â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function handleMicClick() {
  if (isSpeaking) { window.speechSynthesis.cancel(); isSpeaking = false; setStatus('idle'); return; }
  if (!micAvailable) { document.getElementById('textInput').focus(); return; }
  if (isListening) { stopListening(); } else { startListening(); }
}

function startListening() {
  var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  navigator.mediaDevices.getUserMedia({ audio:true })
    .then(function(stream) {
      stream.getTracks().forEach(function(t) { t.stop(); });
      recognition = new SR();
      var langCode = LANG === 'hebrew' ? 'he-IL' : LANG === 'yiddish' ? 'yi' : 'en-US';
      recognition.lang = langCode;
      recognition.continuous = false; recognition.interimResults = false; recognition.maxAlternatives = 1;

      recognition.onstart  = function() { isListening = true; setStatus('listening'); document.getElementById('micHint').textContent = 'ğŸ”´ listening â€” speak now!'; };
      recognition.onresult = function(e) {
        var transcript = e.results[0][0].transcript;
        isListening = false; setStatus('idle');
        document.getElementById('micHint').textContent = 'Heard: "' + transcript + '"';
        setTimeout(function() { document.getElementById('micHint').textContent = 'tap mic to speak â€¢ or type your question'; }, 3000);
        sendToHindy(transcript);
      };
      recognition.onerror  = function(e) {
        isListening = false; setStatus('idle');
        var msgs = { 'not-allowed':'Mic blocked! Allow microphone in browser settings.','no-speech':'I heard nothing! Nu, speak up!','network':'Network error.' };
        document.getElementById('micHint').textContent = msgs[e.error] || 'Mic error: ' + e.error;
        setTimeout(function() { document.getElementById('micHint').textContent = 'tap mic to speak â€¢ or type your question'; }, 4000);
      };
      recognition.onend    = function() {
        isListening = false;
        document.getElementById('micBtn').classList.remove('listening');
        document.getElementById('orb').classList.remove('listening');
        if (!isSpeaking) setStatus('idle');
      };
      recognition.start();
    })
    .catch(function(err) {
      isListening = false; setStatus('idle');
      document.getElementById('micHint').textContent = err.name === 'NotFoundError' ? 'No mic found â€” type instead!' : 'Mic blocked â€” type your question below!';
      setTimeout(function() { document.getElementById('micHint').textContent = 'tap mic to speak â€¢ or type your question'; }, 4000);
    });
}

function stopListening() {
  if (recognition) { try { recognition.stop(); } catch(e) {} }
  isListening = false; setStatus('idle');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATUS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setStatus(state) {
  var dot = document.getElementById('statusDot');
  var txt = document.getElementById('statusText');
  var orb = document.getElementById('orb');
  var wf  = document.getElementById('waveform');
  var mb  = document.getElementById('micBtn');

  dot.className = 'status-dot'; orb.className = 'orb'; wf.className = 'waveform'; mb.classList.remove('listening');

  if (state === 'listening') {
    dot.classList.add('listening'); txt.textContent = 'Hindy is listeningâ€¦ (oy, vhat now?)';
    orb.classList.add('listening'); mb.classList.add('listening'); mb.textContent = 'â¹';
  } else if (state === 'speaking') {
    dot.classList.add('speaking'); txt.textContent = 'Hindy is talkingâ€¦ (of course she is)';
    orb.classList.add('speaking'); wf.classList.add('active'); mb.textContent = 'â¹';
  } else if (state === 'thinking') {
    dot.classList.add('thinking'); txt.textContent = 'Hindy is thinkingâ€¦ and searching de internetâ€¦';
    orb.textContent = 'ğŸ¤”';
  } else {
    txt.textContent = 'Ask Hindy anything â€” she knows everything (and vill tell you twice)';
    if (!mb.classList.contains('disabled')) mb.textContent = 'ğŸ¤';
    orb.textContent = 'ğŸ¤';
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('load', function() {
  var saved = localStorage.getItem('hindy_api_key');
  if (saved && saved.startsWith('sk-ant-')) {
    document.getElementById('apiKeyInput').value = saved;
    document.getElementById('apiSection').style.display = 'none';
  }

  if (!micAvailable) {
    var mb = document.getElementById('micBtn');
    mb.classList.add('disabled');
    mb.title = isSecure ? 'Voice not supported in this browser' : 'Needs https:// for mic â€” type below';
    document.getElementById('micHint').textContent = isSecure ? 'voice unavailable â€” type below' : 'needs https:// for voice â€” type below';
  }

  document.getElementById('questionsGrid').addEventListener('click', function(e) {
    var btn = e.target.closest('.q-btn');
    if (btn) { document.querySelectorAll('.q-btn').forEach(function(b){b.classList.remove('active');}); btn.classList.add('active'); }
  });
  document.getElementById('orb').addEventListener('click', function(e) { e.stopPropagation(); handleMicClick(); });
  document.getElementById('deviceEl').addEventListener('click', handleMicClick);
  document.getElementById('micBtn').addEventListener('click', handleMicClick);
  document.getElementById('sendBtn').addEventListener('click', handleTextSubmit);
  document.getElementById('textInput').addEventListener('keydown', function(e) { if (e.key==='Enter') handleTextSubmit(); });

  if (window.speechSynthesis) {
    window.speechSynthesis.getVoices();
    if (window.speechSynthesis.onvoiceschanged !== undefined) {
      window.speechSynthesis.onvoiceschanged = function() { window.speechSynthesis.getVoices(); };
    }
  }

  setTimeout(function() {
    var shabbatStatus = getJewishStatus();
    if (shabbatStatus.blocked) { showShabbatOverlay(shabbatStatus); return; }
    if (shabbatStatus.minor) {
      typeAndSpeak("Shalom! A reminder â€” today is " + shabbatStatus.name + ". " + shabbatStatus.message + " Now, how can I help you?", "Baruch Hashem âœ¡ï¸");
      return;
    }
    typeAndSpeak(
      "Nu, shalom! I'm Hindy, and I just got a major upgrade â€” now I have a BRAIN! I can search de internet, I know vhat time it is vherever you are, I speak Hebrew AND Yiddish, and I can find you de best kosher deals in your neighborhood. Tap de location button so I know vhere you are, then ask me anything. Vhat, you're still standing dere?",
      "Baruch Hashem âœ¡ï¸"
    );
  }, 700);
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESTAURANT FINDER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var selectedCerts    = [];
var selectedFeatures = [];

function toggleRestaurantPanel() {
  var panel = document.getElementById('restaurantPanel');
  var label = document.getElementById('restToggleLabel');
  var isOpen = panel.classList.toggle('open');
  label.textContent = isOpen ? 'Close Restaurant Finder' : 'Open Kosher Restaurant Finder';
  if (isOpen) {
    var locInput = document.getElementById('restLocation');
    if (!locInput.value && userLocation && userLocation.city) {
      locInput.value = userLocation.city + (userLocation.region ? ', ' + userLocation.region : '');
    }
    panel.scrollIntoView({ behavior:'smooth', block:'start' });
  }
}

function togglePill(el, type) {
  el.classList.toggle('selected');
  if (type === 'cert') {
    var cert = el.dataset.cert;
    var idx  = selectedCerts.indexOf(cert);
    if (idx === -1) selectedCerts.push(cert); else selectedCerts.splice(idx, 1);
  } else {
    var feat = el.dataset.feat;
    var fi   = selectedFeatures.indexOf(feat);
    if (fi === -1) selectedFeatures.push(feat); else selectedFeatures.splice(fi, 1);
  }
}

function searchRestaurants() {
  if (!checkShabbatGate()) return;
  var apiKey = getApiKey();
  if (!apiKey || !apiKey.startsWith('sk-ant-')) {
    document.getElementById('apiSection').style.display = 'block';
    document.getElementById('apiKeyInput').focus();
    return;
  }

  var location = document.getElementById('restLocation').value.trim();
  var menuType = document.getElementById('restMenuType').value;
  var cuisine  = document.getElementById('restCuisine').value;

  if (!location && userLocation) {
    location = userLocation.city + (userLocation.region ? ', ' + userLocation.region : '');
  }
  if (!location) {
    document.getElementById('restLocation').focus();
    document.getElementById('restLocation').style.borderColor = 'var(--burgundy)';
    setTimeout(function() { document.getElementById('restLocation').style.borderColor = ''; }, 2000);
    return;
  }

  var queryParts = ['kosher restaurants', 'near ' + location];
  if (menuType)               queryParts.push(menuType);
  if (cuisine)                queryParts.push(cuisine + ' cuisine');
  if (selectedCerts.length)    queryParts.push('with ' + selectedCerts.join(' or ') + ' certification');
  if (selectedFeatures.length) queryParts.push(selectedFeatures.join(', '));
  var searchQuery = queryParts.join(', ');

  var loading = document.getElementById('restLoading');
  var empty   = document.getElementById('restEmpty');
  var results = document.getElementById('restResults');
  loading.classList.add('active');
  empty.classList.remove('active');
  results.innerHTML = '';

  var prompt = [
    'Search for kosher restaurants matching this request: ' + searchQuery + '.',
    'Return results as a JSON array (NO markdown, NO backticks, ONLY raw JSON).',
    'Each item: name, address, cuisine, menuType (Fleishig/Milchig/Pareve/Vegan), certification, certLevel, features (array), priceRange ($/$$/$$$/$$$$), rating (1-5 or null), description (1-2 sentences), phone, hours, website.',
    'Find real restaurants. Return 3-8 results. Return ONLY the JSON array.'
  ].join(' ');

  fetch('https://api.anthropic.com/v1/messages', {
    method:'POST',
    headers:{
      'Content-Type':'application/json',
      'x-api-key':apiKey,
      'anthropic-version':'2023-06-01',
      'anthropic-dangerous-direct-browser-access':'true'
    },
    body:JSON.stringify({
      model:CLAUDE_MODEL, max_tokens:2000,
      tools:[{ type:'web_search_20250305', name:'web_search' }],
      messages:[{ role:'user', content:prompt }]
    })
  })
  .then(function(r) {
    if (!r.ok) return r.json().then(function(e) { throw new Error(e.error && e.error.message || r.status); });
    return r.json();
  })
  .then(function(data) {
    loading.classList.remove('active');
    var rawText = '';
    if (data.content) { data.content.forEach(function(block) { if (block.type === 'text') rawText += block.text; }); }
    rawText = rawText.replace(/```json|```/g, '').trim();
    var arrStart = rawText.indexOf('[');
    var arrEnd   = rawText.lastIndexOf(']');
    if (arrStart === -1 || arrEnd === -1) throw new Error('No JSON array found');
    var restaurants = JSON.parse(rawText.slice(arrStart, arrEnd + 1));
    if (!restaurants.length) { empty.classList.add('active'); return; }
    renderRestaurants(restaurants);
    var summary = 'I found ' + restaurants.length + ' kosher restaurants near ' + location + '. De top pick is ' + restaurants[0].name + ', ' + (restaurants[0].cuisine || '') + ' ' + (restaurants[0].menuType || '') + ', certified by ' + (restaurants[0].certification || 'a kosher agency') + '. Scroll down to see all de results, darling.';
    typeAndSpeak(summary, 'Baruch Hashem âœ¡ï¸');
  })
  .catch(function(err) {
    loading.classList.remove('active');
    empty.textContent = 'Oy, something went wrong: ' + err.message + '. Try again!';
    empty.classList.add('active');
  });
}

function renderRestaurants(list) {
  var container = document.getElementById('restResults');
  container.innerHTML = '';
  list.forEach(function(r, i) {
    var menuClass = '';
    var mt = (r.menuType || '').toLowerCase();
    if (mt.includes('fleishig') || mt.includes('meat')) menuClass = 'meat';
    else if (mt.includes('milchig') || mt.includes('dairy')) menuClass = 'dairy';
    else if (mt.includes('pareve') || mt.includes('vegan')) menuClass = 'pareve';

    var stars = '';
    if (r.rating) { for (var s = 0; s < 5; s++) stars += s < Math.round(r.rating) ? 'â˜…' : 'â˜†'; }

    var featBadges = '';
    if (r.features && r.features.length) { r.features.slice(0,4).forEach(function(f) { featBadges += '<span class="rest-badge">' + f + '</span>'; }); }

    var contactRow = '';
    if (r.phone || r.website) {
      contactRow = '<div style="margin-top:7px;display:flex;gap:10px;flex-wrap:wrap">';
      if (r.phone)   contactRow += '<a href="tel:' + r.phone + '" style="color:var(--gold);font-size:0.75rem;text-decoration:none">ğŸ“ ' + r.phone + '</a>';
      if (r.website) contactRow += '<a href="' + r.website + '" target="_blank" style="color:var(--gold);font-size:0.75rem;text-decoration:none">ğŸŒ Website</a>';
      contactRow += '</div>';
    }

    var isNote = r.name && r.name.includes('Note');
    var card = document.createElement('div');
    card.className = 'rest-card';
    card.style.animationDelay = (i * 0.07) + 's';

    if (isNote) {
      card.innerHTML = '<div style="color:rgba(240,230,200,0.55);font-style:italic;font-size:0.85rem;text-align:center;padding:4px">' + (r.description || '') + '</div>';
    } else {
      card.innerHTML = [
        '<div class="rest-card-header">',
          '<div class="rest-card-name">' + (r.name || 'Unknown') + '</div>',
          '<div class="rest-card-cert ' + menuClass + '">' + (r.certification || 'Kosher') + '</div>',
        '</div>',
        '<div class="rest-card-meta">',
          (r.cuisine  ? '<span class="rest-badge">ğŸ´ ' + r.cuisine + '</span>' : ''),
          (r.menuType ? '<span class="rest-badge">' + r.menuType + '</span>' : ''),
          (r.certLevel ? '<span class="rest-badge">' + r.certLevel + '</span>' : ''),
          (r.priceRange ? '<span class="rest-badge">' + r.priceRange + '</span>' : ''),
          (stars ? '<span class="rest-badge" style="color:var(--gold)">' + stars + '</span>' : ''),
          featBadges,
        '</div>',
        (r.description ? '<div class="rest-card-desc">' + r.description + '</div>' : ''),
        (r.address ? '<div class="rest-card-address">ğŸ“ ' + r.address + '</div>' : ''),
        (r.hours ? '<div style="color:rgba(240,230,200,0.4);font-size:0.72rem;margin-top:4px">ğŸ• ' + r.hours + '</div>' : ''),
        contactRow
      ].join('');
    }
    container.appendChild(card);
  });
}
</script>
</body>
</html>
